[tox]
envlist =
    py{38,39,310,311,312}-django{32,40,41,42,50}
    lint
    type
    coverage
    docs
skip_missing_interpreters = true

[testenv]
deps =
    django32: Django>=3.2,<4.0
    django40: Django>=4.0,<4.1
    django41: Django>=4.1,<4.2
    django42: Django>=4.2,<5.0
    django50: Django>=5.0,<5.1
    -e{toxinidir}[dev]

commands =
    pytest {posargs}

[testenv:lint]
basepython = python3.11
commands =
    flake8 djpaystack
    black --check djpaystack
    isort --check-only djpaystack

[testenv:type]
basepython = python3.11
commands =
    mypy djpaystack --ignore-missing-imports

[testenv:coverage]
basepython = python3.11
commands =
    pytest --cov=djpaystack --cov-report=html --cov-report=term-missing {posargs}

[testenv:docs]
basepython = python3.11
extras = docs
changedir = docs
commands =
    sphinx-build -W -b html -d {envtmpdir}/doctrees . {envtmpdir}/html

[testenv:format]
basepython = python3.11
commands =
    black djpaystack
    isort djpaystack

[pytest]
DJANGO_SETTINGS_MODULE = tests.settings
python_files = test_*.py
testpaths = djpaystack/tests
addopts = --strict-markers

markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests

[coverage:run]
branch = True
source = djpaystack
omit =
    */migrations/*
    */tests/*
    */test_*.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
    @abc.abstractmethod

[flake8]
max-line-length = 100
exclude =
    .git
    __pycache__
    .venv
    venv
    build
    dist
    migrations
ignore = E203, W503, E501

[isort]
profile = black
line_length = 100
skip_gitignore = true
